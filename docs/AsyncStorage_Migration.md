# Документация по переходу с SQLite на AsyncStorage

## Обзор изменений

В данном проекте была произведена замена SQLite на AsyncStorage для хранения данных о расходах и категориях. Это изменение было необходимо для устранения ошибки "Cannot read property 'exec' of undefined", которая возникала при попытке запуска приложения.

## Основные изменения

1. Удалены зависимости:
   - expo-sqlite
   - expo-sqlite-orm

2. Добавлены зависимости:
   - @react-native-async-storage/async-storage

3. Полностью переработан файл `ExpenseContext.js`:
   - Заменена логика работы с SQLite на AsyncStorage
   - Сохранен тот же API контекста для совместимости с остальными компонентами
   - Реализованы все те же функции для работы с расходами и категориями

## Структура хранения данных

Данные теперь хранятся в AsyncStorage в виде JSON-строк по следующим ключам:

- `@expenses` - список всех расходов
- `@categories` - список всех категорий
- `@storage_initialized` - флаг инициализации хранилища

### Формат данных расходов

```javascript
{
  id: String, // Уникальный идентификатор
  amount: Number, // Сумма расхода
  currency: String, // Валюта
  category_id: String, // ID категории
  description: String, // Описание
  date: Number, // Дата в формате timestamp
  created_at: Number, // Дата создания в формате timestamp
  updated_at: Number, // Дата обновления в формате timestamp
  is_deleted: Boolean // Флаг удаления (для мягкого удаления)
}
```

### Формат данных категорий

```javascript
{
  id: String, // Уникальный идентификатор
  name: String, // Название категории
  icon: String, // Иконка
  color: String, // Цвет
  is_default: Boolean, // Флаг категории по умолчанию
  created_at: Number, // Дата создания в формате timestamp
  updated_at: Number // Дата обновления в формате timestamp
}
```

## Реализованные функции

### Инициализация хранилища

```javascript
const initStorage = async () => {
  // Проверка инициализации и создание начальных данных
}
```

### Операции с расходами

```javascript
const loadExpenses = async () => {
  // Загрузка расходов из хранилища
}

const addExpense = async (expenseData) => {
  // Добавление нового расхода
}

const updateExpense = async (id, expenseData) => {
  // Обновление существующего расхода
}

const deleteExpense = async (id) => {
  // Мягкое удаление расхода
}
```

### Операции с категориями

```javascript
const loadCategories = async () => {
  // Загрузка категорий из хранилища
}

const addCategory = async (categoryData) => {
  // Добавление новой категории
}

const updateCategory = async (id, categoryData) => {
  // Обновление существующей категории
}

const deleteCategory = async (id) => {
  // Удаление категории
}
```

## Преимущества AsyncStorage

1. **Простота использования** - AsyncStorage имеет более простой API по сравнению с SQLite
2. **Надежность** - Меньше зависимостей и потенциальных точек отказа
3. **Производительность** - Для небольших наборов данных AsyncStorage работает достаточно быстро
4. **Совместимость** - Лучшая совместимость с различными версиями React Native и Expo

## Ограничения

1. **Объем данных** - AsyncStorage не рекомендуется для хранения больших объемов данных
2. **Сложные запросы** - Отсутствие возможности выполнять сложные SQL-запросы
3. **Транзакции** - Отсутствие поддержки транзакций

## Рекомендации по дальнейшему развитию

1. Добавить кэширование данных для улучшения производительности
2. Реализовать пагинацию для больших списков расходов
3. Добавить синхронизацию с облачным хранилищем для резервного копирования данных
